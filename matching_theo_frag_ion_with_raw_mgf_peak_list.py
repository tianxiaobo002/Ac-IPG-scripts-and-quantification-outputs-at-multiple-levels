def adding_measured_intensity_to_thero_frag_ions (work_path,thero_frag_ions,raw_mgf_dict):
    print ('trying match ions')
    file_path = work_path

    import copy

    three_plex_all_thero_frag_ions = copy.deepcopy(thero_frag_ions)
    three_plex_all_thero_frag_ions_unmodified = copy.deepcopy(thero_frag_ions)
    raw_mgf_MS2_spectra_list = copy.deepcopy(raw_mgf_dict)

    for retention_time in three_plex_all_thero_frag_ions.keys():

        retention_time_on_matching = retention_time
        raw_mgf_MS2_spectra_list_on_matching = raw_mgf_MS2_spectra_list [retention_time_on_matching]
        three_plex_all_thero_frag_ions_on_matching = three_plex_all_thero_frag_ions_unmodified [retention_time_on_matching]
        numbers_theo_ions = len (three_plex_all_thero_frag_ions_unmodified [retention_time_on_matching])-1
        numbers_peak_list = len (raw_mgf_MS2_spectra_list [retention_time_on_matching])-1
            
        for i in range (0,numbers_theo_ions):
            value_theo_ion = three_plex_all_thero_frag_ions_unmodified [retention_time_on_matching][i][2]
            match_peak_number = 0
            
            for j in range (0,numbers_peak_list):
                value_peak_list = raw_mgf_MS2_spectra_list [retention_time_on_matching][j][0]
                matched_peaks = []
                matched_peak_value = {}
                if (value_peak_list - 0.04) < value_theo_ion and value_theo_ion < (value_peak_list + 0.04):
                    match_peak_number = match_peak_number + 1
                    matched_peak_value[(raw_mgf_MS2_spectra_list [retention_time_on_matching][j][0])] = (raw_mgf_MS2_spectra_list [retention_time_on_matching][j][1])
                    matched_peaks.append (raw_mgf_MS2_spectra_list [retention_time_on_matching][j][0])
                    initi_diff_abs = 2
                    for each_peak in matched_peaks:
                        if abs (each_peak - value_theo_ion) < initi_diff_abs :
                            closest_peak = each_peak
                            initi_diff_abs = abs (each_peak - value_theo_ion)
                    three_plex_all_thero_frag_ions [retention_time_on_matching][i].append (matched_peak_value [closest_peak])  
                            
            if match_peak_number == 0:
                three_plex_all_thero_frag_ions [retention_time_on_matching][i].append ('0')
        
        '''print ('raw_mgf',raw_mgf_MS2_spectra_list [scan_number_on_matching][-1:][0][1][1])
        print ('peaks',four_plex_all_thero_frag_ions_unmodified [scan_number_on_matching][-1:][0][1][0][1])'''
        if (float (raw_mgf_MS2_spectra_list [retention_time_on_matching][-1:][0][1][1])-0.2) <three_plex_all_thero_frag_ions_unmodified [retention_time_on_matching][-1:][0][1][0][1]<(float (raw_mgf_MS2_spectra_list [retention_time_on_matching][-1:][0][1][1])+0.2):
            three_plex_all_thero_frag_ions [retention_time_on_matching][-1:][0][1].append (['determining_precursor_selection',1])
        else:
            three_plex_all_thero_frag_ions [retention_time_on_matching][-1:][0][1].append (['determining_precursor_selection',0])
    output_file = open (file_path + 'Dict_all_fragment_ion_add_matched_intens.txt', 'w')
    output_file.write(str(three_plex_all_thero_frag_ions))
    output_file.close()

    return three_plex_all_thero_frag_ions


'''thero_frag_ions_test = {6302: [['b1_13C+0', 'S', 349.0705], ['b1_13C+1', 'S', 350.0739], ['b1_13C+2', 'S', 351.0773], ['b1_13C+3', 'S', 352.0807], ['b2_13C+0', 'SE', 478.1131], ['b2_13C+1', 'SE', 479.1165], ['b2_13C+2', 'SE', 480.1199], ['b2_13C+3', 'SE', 481.1233], ['b3_13C+0', 'SEI', 591.1945], ['b3_13C+1', 'SEI', 592.1979], ['b3_13C+2', 'SEI', 593.2013], ['b3_13C+3', 'SEI', 594.2047], ['b4_13C+0', 'SEIA', 662.2316], ['b4_13C+1', 'SEIA', 663.235], ['b4_13C+2', 'SEIA', 664.2384], ['b4_13C+3', 'SEIA', 665.2418], ['b5_13C+0', 'SEIAH', 799.2905], ['b5_13C+1', 'SEIAH', 800.2939], ['b5_13C+2', 'SEIAH', 801.2973], ['b5_13C+3', 'SEIAH', 802.3007], ['b6_13C+0', 'SEIAHR', 955.3916], ['b6_13C+1', 'SEIAHR', 956.395], ['b6_13C+2', 'SEIAHR', 957.3984], ['b6_13C+3', 'SEIAHR', 958.4018], ['b7_13C+0', 'SEIAHRF', 1102.46], ['b7_13C+1', 'SEIAHRF', 1103.4634], ['b7_13C+2', 'SEIAHRF', 1104.4668], ['b7_13C+3', 'SEIAHRF', 1105.4702], ['b1_-H2O_13C+0', 'S', 331.0599], ['b1_-H2O_13C+1', 'S', 332.0633], ['b1_-H2O_13C+2', 'S', 333.0667], ['b1_-H2O_13C+3', 'S', 334.0701], ['b1_-NH3_13C+0', 'S', 332.044], ['b1_-NH3_13C+1', 'S', 333.0474], ['b1_-NH3_13C+2', 'S', 334.0508], ['b1_-NH3_13C+3', 'S', 335.0542], ['b2_-H2O_13C+0', 'SE', 460.1025], ['b2_-H2O_13C+1', 'SE', 461.1059], ['b2_-H2O_13C+2', 'SE', 462.1093], ['b2_-H2O_13C+3', 'SE', 463.1127], ['b2_-NH3_13C+0', 'SE', 461.0866], ['b2_-NH3_13C+1', 'SE', 462.09], ['b2_-NH3_13C+2', 'SE', 463.0934], ['b2_-NH3_13C+3', 'SE', 464.0968], ['b3_-H2O_13C+0', 'SEI', 573.1839], ['b3_-H2O_13C+1', 'SEI', 574.1873], ['b3_-H2O_13C+2', 'SEI', 575.1907], ['b3_-H2O_13C+3', 'SEI', 576.1941], ['b3_-NH3_13C+0', 'SEI', 574.168], ['b3_-NH3_13C+1', 'SEI', 575.1714], ['b3_-NH3_13C+2', 'SEI', 576.1748], ['b3_-NH3_13C+3', 'SEI', 577.1782], ['b4_-H2O_13C+0', 'SEIA', 644.221], ['b4_-H2O_13C+1', 'SEIA', 645.2244], ['b4_-H2O_13C+2', 'SEIA', 646.2278], ['b4_-H2O_13C+3', 'SEIA', 647.2312], ['b4_-NH3_13C+0', 'SEIA', 645.2051], ['b4_-NH3_13C+1', 'SEIA', 646.2085], ['b4_-NH3_13C+2', 'SEIA', 647.2119], ['b4_-NH3_13C+3', 'SEIA', 648.2153], ['b5_-H2O_13C+0', 'SEIAH', 781.2799], ['b5_-H2O_13C+1', 'SEIAH', 782.2833], ['b5_-H2O_13C+2', 'SEIAH', 783.2867], ['b5_-H2O_13C+3', 'SEIAH', 784.2901], ['b5_-NH3_13C+0', 'SEIAH', 782.264], ['b5_-NH3_13C+1', 'SEIAH', 783.2674], ['b5_-NH3_13C+2', 'SEIAH', 784.2708], ['b5_-NH3_13C+3', 'SEIAH', 785.2742], ['b6_-H2O_13C+0', 'SEIAHR', 937.381], ['b6_-H2O_13C+1', 'SEIAHR', 938.3844], ['b6_-H2O_13C+2', 'SEIAHR', 939.3878], ['b6_-H2O_13C+3', 'SEIAHR', 940.3912], ['b6_-NH3_13C+0', 'SEIAHR', 938.3651], ['b6_-NH3_13C+1', 'SEIAHR', 939.3685], ['b6_-NH3_13C+2', 'SEIAHR', 940.3719], ['b6_-NH3_13C+3', 'SEIAHR', 941.3753], ['b7_-H2O_13C+0', 'SEIAHRF', 1084.4494], ['b7_-H2O_13C+1', 'SEIAHRF', 1085.4528], ['b7_-H2O_13C+2', 'SEIAHRF', 1086.4562], ['b7_-H2O_13C+3', 'SEIAHRF', 1087.4596], ['b7_-NH3_13C+0', 'SEIAHRF', 1085.4335], ['b7_-NH3_13C+1', 'SEIAHRF', 1086.4369], ['b7_-NH3_13C+2', 'SEIAHRF', 1087.4403], ['b7_-NH3_13C+3', 'SEIAHRF', 1088.4437], ['y1_13C+0', 'K', 260.161], ['y1_13C+1', 'K', 261.1644], ['y1_13C+2', 'K', 262.1678], ['y1_13C+3', 'K', 263.1712], ['y2_13C+0', 'KF', 407.2294], ['y2_13C+1', 'KF', 408.2328], ['y2_13C+2', 'KF', 409.2362], ['y2_13C+3', 'KF', 410.2396], ['y3_13C+0', 'KFR', 563.3305], ['y3_13C+1', 'KFR', 564.3339], ['y3_13C+2', 'KFR', 565.3373], ['y3_13C+3', 'KFR', 566.3407], ['y4_13C+0', 'KFRH', 700.3894], ['y4_13C+1', 'KFRH', 701.3928], ['y4_13C+2', 'KFRH', 702.3962], ['y4_13C+3', 'KFRH', 703.3996], ['y5_13C+0', 'KFRHA', 771.4265], ['y5_13C+1', 'KFRHA', 772.4299], ['y5_13C+2', 'KFRHA', 773.4333], ['y5_13C+3', 'KFRHA', 774.4367], ['y6_13C+0', 'KFRHAI', 884.5079], ['y6_13C+1', 'KFRHAI', 885.5113], ['y6_13C+2', 'KFRHAI', 886.5147], ['y6_13C+3', 'KFRHAI', 887.5181], ['y7_13C+0', 'KFRHAIE', 1013.5505], ['y7_13C+1', 'KFRHAIE', 1014.5539], ['y7_13C+2', 'KFRHAIE', 1015.5573], ['y7_13C+3', 'KFRHAIE', 1016.5607], ['y1_-H2O_13C+0', 'K', 242.1504], ['y1_-H2O_13C+1', 'K', 243.1538], ['y1_-H2O_13C+2', 'K', 244.1572], ['y1_-H2O_13C+3', 'K', 245.1606], ['y1_-NH3_13C+0', 'K', 243.1345], ['y1_-NH3_13C+1', 'K', 244.1379], ['y1_-NH3_13C+2', 'K', 245.1413], ['y1_-NH3_13C+3', 'K', 246.1447], ['y2_-H2O_13C+0', 'KF', 389.2188], ['y2_-H2O_13C+1', 'KF', 390.2222], ['y2_-H2O_13C+2', 'KF', 391.2256], ['y2_-H2O_13C+3', 'KF', 392.229], ['y2_-NH3_13C+0', 'KF', 390.2029], ['y2_-NH3_13C+1', 'KF', 391.2063], ['y2_-NH3_13C+2', 'KF', 392.2097], ['y2_-NH3_13C+3', 'KF', 393.2131], ['y3_-H2O_13C+0', 'KFR', 545.3199], ['y3_-H2O_13C+1', 'KFR', 546.3233], ['y3_-H2O_13C+2', 'KFR', 547.3267], ['y3_-H2O_13C+3', 'KFR', 548.3301], ['y3_-NH3_13C+0', 'KFR', 546.304], ['y3_-NH3_13C+1', 'KFR', 547.3074], ['y3_-NH3_13C+2', 'KFR', 548.3108], ['y3_-NH3_13C+3', 'KFR', 549.3142], ['y4_-H2O_13C+0', 'KFRH', 682.3788], ['y4_-H2O_13C+1', 'KFRH', 683.3822], ['y4_-H2O_13C+2', 'KFRH', 684.3856], ['y4_-H2O_13C+3', 'KFRH', 685.389], ['y4_-NH3_13C+0', 'KFRH', 683.3629], ['y4_-NH3_13C+1', 'KFRH', 684.3663], ['y4_-NH3_13C+2', 'KFRH', 685.3697], ['y4_-NH3_13C+3', 'KFRH', 686.3731], ['y4_2charge_13C+0', 'KFRH', 351.2025], ['y4_2charge_13C+1', 'KFRH', 352.2059], ['y4_2charge_13C+2', 'KFRH', 353.2093], ['y4_2charge_13C+3', 'KFRH', 354.2127], ['y5_-H2O_13C+0', 'KFRHA', 753.4159], ['y5_-H2O_13C+1', 'KFRHA', 754.4193], ['y5_-H2O_13C+2', 'KFRHA', 755.4227], ['y5_-H2O_13C+3', 'KFRHA', 756.4261], ['y5_-NH3_13C+0', 'KFRHA', 754.4], ['y5_-NH3_13C+1', 'KFRHA', 755.4034], ['y5_-NH3_13C+2', 'KFRHA', 756.4068], ['y5_-NH3_13C+3', 'KFRHA', 757.4102], ['y5_2charge_13C+0', 'KFRHA', 386.721], ['y5_2charge_13C+1', 'KFRHA', 387.7244], ['y5_2charge_13C+2', 'KFRHA', 388.7278], ['y5_2charge_13C+3', 'KFRHA', 389.7312], ['y6_-H2O_13C+0', 'KFRHAI', 866.4973], ['y6_-H2O_13C+1', 'KFRHAI', 867.5007], ['y6_-H2O_13C+2', 'KFRHAI', 868.5041], ['y6_-H2O_13C+3', 'KFRHAI', 869.5075], ['y6_-NH3_13C+0', 'KFRHAI', 867.4814], ['y6_-NH3_13C+1', 'KFRHAI', 868.4848], ['y6_-NH3_13C+2', 'KFRHAI', 869.4882], ['y6_-NH3_13C+3', 'KFRHAI', 870.4916], ['y6_2charge_13C+0', 'KFRHAI', 443.2618], ['y6_2charge_13C+1', 'KFRHAI', 444.2652], ['y6_2charge_13C+2', 'KFRHAI', 445.2686], ['y6_2charge_13C+3', 'KFRHAI', 446.272], ['y7_-H2O_13C+0', 'KFRHAIE', 995.5399], ['y7_-H2O_13C+1', 'KFRHAIE', 996.5433], ['y7_-H2O_13C+2', 'KFRHAIE', 997.5467], ['y7_-H2O_13C+3', 'KFRHAIE', 998.5501], ['y7_-NH3_13C+0', 'KFRHAIE', 996.524], ['y7_-NH3_13C+1', 'KFRHAIE', 997.5274], ['y7_-NH3_13C+2', 'KFRHAIE', 998.5308], ['y7_-NH3_13C+3', 'KFRHAIE', 999.5342], ['y7_2charge_13C+0', 'KFRHAIE', 507.7831], ['y7_2charge_13C+1', 'KFRHAIE', 508.7865], ['y7_2charge_13C+2', 'KFRHAIE', 509.7899], ['y7_2charge_13C+3', 'KFRHAIE', 510.7933], ['spectrum_information', [['m_over_z', 682.8141], ['retention_time', 1807.2], ['peptide', 'SEIAHRFK'], ['mass', 1363.6183], ['charge_states', 2], ['logP', 36.75], ['length', 8], ['ppm', -3.4], ['area', '9.4865E8'], ['protein_accession', 'P02769']]]]
}

raw_mgf_dict_test = {6302: [[102.0552, 855181.3125], [110.071, 1622243.5], [121.5225, 160025.1094], [147.1129, 736115.6875], [158.0461, 168139.9375], [164.0362, 182763.9844], [165.0412, 182776.2031], [167.0482, 170508.875], [168.0284, 1069065.5], [171.0759, 260837.2188], [186.0381, 3264579.75], [189.0864, 280535.1875], [192.0758, 172635.1406], [194.698, 156657.9531], [197.1297, 538163.9375], [199.0699, 3973485.5], [202.0175, 902149.0], [203.0207, 898363.75], [209.1024, 228577.8906], [215.1378, 735203.9375], [217.0805, 1808075.625], [220.0263, 259742.9844], [223.7726, 171042.625], [231.9664, 211616.5625], [243.134, 274019.5938], [260.16, 589575.25], [261.0538, 229786.625], [261.1658, 304855.3125], [262.1655, 558615.875], [263.1709, 303316.7188], [271.0365, 173668.9531], [277.139, 325608.1562], [289.0489, 179511.8125], [290.0489, 270835.0938], [294.1791, 1274788.375], [297.0706, 312631.625], [304.0685, 231907.5469], [311.3165, 172505.2812], [315.0806, 162380.9062], [322.1848, 271060.8125], [329.6908, 668501.5], [330.1626, 284384.5625], [331.0555, 1554115.75], [332.0619, 1185224.5], [333.064, 1092276.0], [334.0711, 1082826.0], [342.1917, 174809.8906], [349.0691, 1902503.625], [350.0693, 1562874.25], [350.6984, 244923.0938], [351.0787, 753759.8125], [351.1972, 184259.4219], [351.7034, 190909.5625], [352.0777, 1368160.25], [352.2044, 897756.875], [365.205, 613664.375], [386.2276, 636059.5], [386.7176, 527228.9375], [387.2158, 742147.875], [407.2264, 624678.125], [408.2337, 349911.875], [409.2369, 677629.625], [410.236, 849589.8125], [419.0931, 184031.9531], [432.1075, 209962.0938], [433.106, 207343.0156], [433.2513, 225062.9531], [441.7479, 246711.1406], [442.0916, 352263.4688], [442.7536, 283454.0938], [443.0984, 232751.625], [443.2576, 311066.1875], [443.7626, 758624.375], [444.0997, 193225.4844], [444.2684, 626713.6875], [445.1045, 242054.7656], [450.2884, 194637.0312], [460.0974, 1563130.625], [461.0994, 2031038.375], [462.1044, 1456113.5], [463.1153, 1470833.125], [478.1142, 923492.0625], [479.118, 1314714.25], [480.1235, 995121.625], [481.1229, 845429.625], [494.268, 1324212.5], [498.2738, 172588.9531], [498.7806, 352585.4062], [499.2775, 214758.5469], [499.7752, 526376.6875], [507.2766, 244449.7812], [507.7755, 353702.7188], [508.2859, 215371.625], [508.7863, 187330.3594], [530.2893, 350017.0], [538.242, 221315.4688], [543.2871, 204679.5781], [550.7986, 753783.9375], [551.3017, 839469.875], [551.7931, 681930.375], [552.2975, 841836.1875], [560.7271, 219115.375], [561.2438, 222195.1094], [563.3276, 1533017.5], [564.3324, 1507670.75], [565.3351, 1972881.875], [566.3355, 1339827.5], [570.3188, 229266.5625], [587.342, 573664.4375], [615.7819, 229106.3281], [617.292, 797612.0625], [617.7869, 225457.7188], [624.7929, 766542.25], [625.2811, 1072235.5], [625.7865, 923373.6875], [626.2917, 270563.0938], [641.3493, 562932.75], [652.3019, 200877.8281], [658.3769, 1330240.625], [660.8063, 296898.8125], [661.3061, 803269.0], [673.8043, 2033147.125], [682.8178, 8021406.5], [682.9364, 255937.9219], [683.3428, 173730.7969], [694.3686, 648415.0625], [700.3946, 3417394.5], [701.3993, 2721766.25], [702.3842, 3689109.0], [703.3933, 3383925.5], [755.4053, 286368.1562], [771.4271, 5251915.0], [772.4268, 5554512.5], [773.4248, 6313523.0], [774.4249, 6475699.5], [884.5133, 1271257.375], [885.5083, 1481627.875], [886.5166, 2040247.875], [887.5144, 2084363.25], [900.4929, 212153.0312], [913.3673, 181050.7344], [955.3977, 240325.2031], [956.3788, 265952.5312], [958.4017, 308347.6562], [998.5394, 211476.4062], [1013.5506, 949708.1875], [1014.5613, 946727.9375], [1015.5428, 835570.9375], [1016.5515, 1060332.625], [1120.456, 235877.1719], [1122.4864, 189997.5312], [['retention_seconds', 1858.5325], ['pep_precursor', 682.8149], ['charge_states', '2+']]]
}
working_path = 'G:\\Desktop\\NAPI-tag\\Scripts for Ac-IPG tag\\'

test_result = adding_measured_intensity_to_thero_frag_ions (working_path,thero_frag_ions_test,raw_mgf_dict_test)'''
